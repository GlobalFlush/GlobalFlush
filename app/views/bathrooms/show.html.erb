
<script type="text/javascript"
          src="http://maps.google.com/maps/api/js?sensor=true">
</script>
<script type="text/javascript" language="javascript">
  var your_city = new google.maps.LatLng(<%= @bathroom.address.latitude %>, <%= @bathroom.address.longitude %>);
  var your_place = new google.maps.LatLng(<%= @bathroom.address.latitude %>, <%= @bathroom.address.longitude %>);
  var marker;
  var map;
  google.maps.event.addDomListener(window, "load", initialize);
  function initialize() {
      var mapOptions = {
          zoom: 15,
          mapTypeId: google.maps.MapTypeId.ROADMAP,
          center: your_city
      };
      map = new google.maps.Map(document.getElementById("map"),
              mapOptions);
      marker = new google.maps.Marker({
          map:map,
          draggable:true,
          animation: google.maps.Animation.DROP,
          position: your_place
      });
      google.maps.event.addListener(marker, 'click', toggleBounce);
  }
  function toggleBounce() {
      if (marker.getAnimation() != null) {
          marker.setAnimation(null);
      } else {
          marker.setAnimation(google.maps.Animation.BOUNCE);
      }
  }
</script>

<script type="text/javascript" language="javascript">
var oMax;	// Isthe maximum number of stars
var cMax;
var sMax;
//var holder; // Is the holding pattern for clicked state
var preSet_overall; // Is the PreSet value onces a selection has been made
var preSet_clean;
var preSet_smell;
var overall_rated = 0;
var smell_rated = 0;
var clean_rated = 0;

// Rollover for image Stars //
function rating(num){
	sMax = 0;	// Isthe maximum number of stars
	cMax = 0;
	oMax = 0;
	for(n=0; n<num.parentNode.childNodes.length; n++){
		if(num.parentNode.childNodes[n].nodeName == "A"){
			if(num.id[0] == 0){
				oMax++;	
			}
			if(num.id[0] == 1){
				cMax++;
			}
			if(num.id[0] == 2){
				sMax++;
			}
		}
	}
	
	if(!overall_rated){
		s = num.id.replace("0", ''); // Get the selected star
		//a = 0;
		for(i=1; i<=oMax; i++){		
			if(i<=s){
				document.getElementById("0"+i).className = "onstar";
				//document.getElementById("rateStatus").innerHTML = num.title;	
				//holder = a+1;
				//a++;
			}else{
				document.getElementById("0"+i).className = "offstar";
			}
		}

	}
	if(!clean_rated){
		s = num.id.replace("1", ''); // Get the selected star
		//a = 0;
		for(i=1; i<=cMax; i++){		
			if(i<=s){
				document.getElementById("1"+i).className = "onstar";
				//document.getElementById("rateStatus").innerHTML = num.title;	
				//holder = a+1;
				//a++;
			}else{
				document.getElementById("1"+i).className = "offstar";
			}
		}
	}
	if(!smell_rated){
		s = num.id.replace("2", ''); // Get the selected star
		//a = 0;
		for(i=1; i<=sMax; i++){		
			if(i<=s){
				document.getElementById("2"+i).className = "onstar";
				//document.getElementById("rateStatus").innerHTML = num.title;	
				//holder = a+1;
				//a++;
			}else{
				document.getElementById("2"+i).className = "offstar";
			}
		}
	}
}

// For when you roll out of the the whole thing //
function off(me){
	if(!overall_rated){
		if(!preSet_overall){	
			for(i=1; i<=oMax; i++){		
				document.getElementById("0"+i).className = "offstar";
				//document.getElementById("rateStatus").innerHTML = me.parentNode.title;
			}
		}else{
			rating(preSet_overall);
			//document.getElementById("rateStatus").innerHTML = document.getElementById("ratingSaved").innerHTML;
		}
	}
	if(!clean_rated){
		if(!preSet_clean){	
			for(i=1; i<=cMax; i++){		
				document.getElementById("1"+i).className = "offstar";
				//document.getElementById("rateStatus").innerHTML = me.parentNode.title;
			}
		}else{
			rating(preSet_clean);
			//document.getElementById("rateStatus").innerHTML = document.getElementById("ratingSaved").innerHTML;
		}
	}
	if(!smell_rated){
		if(!preSet_smell){	
			for(i=1; i<=sMax; i++){		
				document.getElementById("2"+i).className = "offstar";
				//document.getElementById("rateStatus").innerHTML = me.parentNode.title;
			}
		}else{
			rating(preSet_smell);
			//document.getElementById("rateStatus").innerHTML = document.getElementById("ratingSaved").innerHTML;
		}
	}
}

// When you actually rate something //
function rate_overall(me){
	if(!overall_rated){
		//document.getElementById("rateStatus").innerHTML = document.getElementById("ratingSaved").innerHTML + " :: "+me.title;
		preSet_overall = me;
		overall_rated=1;
		sendRate(me);
		rating(me);
	}
}
function rate_clean(me){
	if(!clean_rated){
		//document.getElementById("rateStatus").innerHTML = document.getElementById("ratingSaved").innerHTML + " :: "+me.title;
		preSet_clean = me;
		clean_rated=1;
		sendRate(me);
		rating(me);
	}
}

function rate_smell(me){
	if(!smell_rated){
		//document.getElementById("rateStatus").innerHTML = document.getElementById("ratingSaved").innerHTML + " :: "+me.title;
		preSet_smell = me;
		smell_rated=1;
		sendRate(me);
		rating(me);
	}
}

// Send the rating information somewhere using Ajax or something like that.
function sendRate(sel){
	alert("Your rating was: "+sel.title);
}

</script>
<!--  BOT -->

<div id="tools">
  <a href="#">Add to Favorites</a> |
  <a href="#">Check In</a> |
  <a href="#">Share</a> |
  <a href="#">Add Photo</a> |
  <%= link_to "Edit Content", edit_bathroom_path(@bathroom.id) %>
</div>

<div id="big_stars">
  <img src="/images/big_five_star.png" alt="4 Stars" />
</div>


<h1><%= @bathroom.title %> -
<% if @bathroom.gender == "Male" %>
  &#9794;
<% elsif @bathroom.gender == "Female" %>
  &#9792;
<% end %>
</h1>

<div id="left_column">
  <div id="mapbox">
    <div id="map">
    </div>
  </div>

  <%#= render :partial => "bathrooms/map" %>
  
  <h2>Detailed Ratings</h2>

  <div id="rating_box">

    <div id="rb_left">
      <ul>
        <li>Overall Rating</li>   
        <li>Cleanliness</li>
        <li>Smelliness</li>
      </ul>
    </div>
    <div id="rb_right">
      <ul>
	    <li>
			<div class="offstar" onclick="rate_overall(this)" id="01" title="Overall ehh..." onmouseover="rating(this)" onmouseout="off(this)"></div>
			<div class="offstar" onclick="rate_overall(this)" id="02" title="Overall Not Bad" onmouseover="rating(this)" onmouseout="off(this)"></div>
			<div class="offstar" onclick="rate_overall(this)" id="03" title="Overall Good" onmouseover="rating(this)" onmouseout="off(this)"></div>
			<div class="offstar" onclick="rate_overall(this)" id="04" title="Overall Very Good" onmouseover="rating(this)" onmouseout="off(this)"></div>
			<div class="offstar" onclick="rate_overall(this)" id="05" title="Overall Exceptional" onmouseover="rating(this)" onmouseout="off(this)"></div>
		</li>
	    <li>
			<div class="offstar" onclick="rate_overall(this)" id="01" title="Overall ehh..." onmouseover="rating(this)" onmouseout="off(this)"></div>
			<div class="offstar" onclick="rate_overall(this)" id="02" title="Overall Not Bad" onmouseover="rating(this)" onmouseout="off(this)"></div>
			<div class="offstar" onclick="rate_overall(this)" id="03" title="Overall Good" onmouseover="rating(this)" onmouseout="off(this)"></div>
			<div class="offstar" onclick="rate_overall(this)" id="04" title="Overall Very Good" onmouseover="rating(this)" onmouseout="off(this)"></div>
			<div class="offstar" onclick="rate_overall(this)" id="05" title="Overall Exceptional" onmouseover="rating(this)" onmouseout="off(this)"></div>
			</li>	    
		<li>
			<div class="offstar" onclick="rate_overall(this)" id="01" title="Overall ehh..." onmouseover="rating(this)" onmouseout="off(this)"></div>
			<div class="offstar" onclick="rate_overall(this)" id="02" title="Overall Not Bad" onmouseover="rating(this)" onmouseout="off(this)"></div>
			<div class="offstar" onclick="rate_overall(this)" id="03" title="Overall Good" onmouseover="rating(this)" onmouseout="off(this)"></div>
			<div class="offstar" onclick="rate_overall(this)" id="04" title="Overall Very Good" onmouseover="rating(this)" onmouseout="off(this)"></div>
			<div class="offstar" onclick="rate_overall(this)" id="05" title="Overall Exceptional" onmouseover="rating(this)" onmouseout="off(this)"></div>
			</li>
      </ul>
    </div>
  </div>
</div>
<div id="images">
  <% @bathroom.bathroom_photos.each do |bp| %>
    <div><a href="<%= bp.photo.url %>"><%= image_tag bp.photo.url(:thumb) %></a></div>
  <% end %>
  <p><a href="#">View All</a> | <a href="#">Add More</a></p>
</div>

<h2>Address</h2>
<div id="address_box">
  <%= @bathroom.address.to_s %>
</div>

<h2>Attributes</h2>
<div id="attribute_box">
  <div id="ab_left">
    <ul>
      <% @bathroom.bathroom_specs.each do |spec| %>
      <li><%= spec.key %></li>
      <% end %>
    </ul>
  </div>
  <div id="ab_right">
    <ul>
      <% @bathroom.bathroom_specs.each do |spec| %>
      <li><%= spec.value %></li>
      <% end %>
    </ul>
  </div>
</div>

<h2>Write a Review</h2>
<%= form_for :comment, :url => comments_path do |f| %>
    <%= f.text_area :body %>
    <%= f.hidden_field :bathroom_id, :value => @bathroom.id %>
    <br />
    <%= f.submit "Post Comment" %>
<% end %>
<div style="clear:both;"></div>
<h2 class="full">Reviews</h2>

<% @bathroom.comments.each do |comment| %>
<div class="review">
    <div class="username"><%= link_to comment.user.login, comment.user %></div>
    <div class="date_posted"><%= comment.created_at.strftime("%I:%M%p %m/%d/%Y") %></div>
    <p><%= comment.body %></p>
</div>
<%= @bathroom.inspect %>
<%= s = @bathroom.ratings.collect { |c| c.overall} %>
rating: <%= s.size == 0 ? 0 : s.sum.to_f / s.size.to_f %>
<% end %>
