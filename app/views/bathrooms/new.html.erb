<%=javascript_include_tag :defaults %>
<script type="text/javascript"
        src="http://maps.google.com/maps/api/js?sensor=true">
</script>
<script type="text/javascript" language="javascript">
  var your_city = new google.maps.LatLng();
  var your_place = new google.maps.LatLng();
  var marker;
  var map;
  var geocoder = new google.maps.Geocoder();
  google.maps.event.addDomListener(window, "load", initialize);
  function initialize() {
    var mapOptions = {
      zoom: 15,
      mapTypeId: google.maps.MapTypeId.ROADMAP,
      center: your_city
    };
    map = new google.maps.Map(document.getElementById("map_add"),
    mapOptions);
  }
  function getGPS()
  {
	var address = document.getElementById("street").value+", "
				+document.getElementById("city").value+", "
				+document.getElementById("state").value+", "
				+document.getElementById("zip").value+", "
				+document.getElementById("country").value;
	//alert(address);
	geocoder.geocode({"address":address}, markMap);
  }	
  function markMap(results, status)
  {
	if(status == google.maps.GeocoderStatus.OK)
	{
		your_city = results[0].geometry.location;
		map.setCenter(your_city);
		map.setZoom(15);
		marker = new google.maps.Marker({
		  map:map,
		  draggable:true,
		  animation: google.maps.Animation.DROP,
		  position: your_city
		});
		google.maps.event.addListener(marker, 'click', toggleBounce);
		//document.getELementById("add").disabled = false;
	}
	else
	{
		alert("Geocode failed because: "+status);
	}
  }
  
  function save_gps()
  {
		document.getElementById("lat").value = your_city.lat();
		document.getElementById("long").value = your_city.lng();  
  }
  function toggleBounce() {
    if (marker.getAnimation() != null) {
      marker.setAnimation(null);
    } else {
      marker.setAnimation(google.maps.Animation.BOUNCE);
    }
  }
</script>

<h1>Add New Bathroom</h1>

<%= form_for @bathroom, :url => bathrooms_url,:html => {:multipart => true} do |f| %>
    <%= f.error_messages %>

    <h3>Basic Information</h3>
    <%= f.label :title %><br />
    <%= f.text_field :title %><br />
    <br/>

    <%= f.label :gender %><br />
    <%= select("bathroom", "gender", %w[Male Female], {}, {:include_blank => true}) %><br />
    <br/>

    <%= f.label :description %><br />
    <%= f.text_area :description %><br />

    <h3>Address</h3>
    <%= f.fields_for :address do |a| %>
        <%= a.label :inside_location %><br />
        <%= a.text_field :inside_location, :id => "inside" %><br />
        <%= a.label :street_address %><br />
        <%= a.text_field :street_address, :id => "street" %><br />
        <%= a.label :city %><br />
        <%= a.text_field :city, :id => "city" %><br />
        <%= a.label :state %><br />
        <%= a.text_field :state, :id => "state" %><br />
        <%= a.label :zip %><br />
        <%= a.text_field :zip, :id => "zip" %><br />
        <%= a.label :country %><br />
        <%= a.text_field :country, :id => "country" %><br />
		<%= a.hidden_field :latitude, :id => "lat" %><br />
		<%= a.hidden_field :longitude, :id => "long" %><br />
    <% end %>
	
	<button type="button" onclick="getGPS(this)">Check Address</button>
	<div id="mapbox_add">
		<div id="map_add">
		</div>
	</div>
    <h3>Details</h3>
    <table>
    <tr>
        <th>Attribute</th>
        <th>Value</th>
    </tr>
    <%= f.fields_for :bathroom_specs do |spec| %>
      <tr>
        <td><%= spec.text_field :key %></td>
        <td><%= spec.text_field :value %></td>
      </tr>
    <% end %>
    </table>

    <h3>Photos</h3>
    <%= f.fields_for :bathroom_photos do |photo| %>
        <%= photo.file_field :photo %><br />
    <% end %>

    <br/>



    <%= f.submit "Add", :onclick =>"save_gps()"%>
<% end %>

<br />

<%= link_to 'Back All Bathrooms', bathrooms_path %>
